q0 = [0 0 0 0];
qf = [pi/2 pi/2 pi/2 pi/2];
T = 5;

t = linspace(0, T, 100);   % 100 muestras en 5 s

[q, qd, qdd] = jtraj(q0, qf, t);

%% MASAS
M1 = 0.28106;     % [kg]
M2 = 0.33488;     % [kg]
M3 = 0.15786;     % [kg]

%% GRAVEDAD
grav = 9.81;      % [m/s^2]

%% INERCIAS DEL ESLABÓN 1 (g·mm² → kg·m²)
I1xx = 429570.87  * 1e-9;
I1xy = 0          * 1e-9;
I1xz = 0          * 1e-9;
I1yx = 0          * 1e-9;
I1yy = 541406.19  * 1e-9;
I1yz = 4013.23    * 1e-9;
I1zx = 0          * 1e-9;
I1zy = 4013.23    * 1e-9;
I1zz = 396346.61  * 1e-9;

%% INERCIAS DEL ESLABÓN 2
I2xx = 991913.02  * 1e-9;
I2xy = 0          * 1e-9;
I2xz = 0          * 1e-9;
I2yx = 0          * 1e-9;
I2yy = 1437769.51 * 1e-9;
I2yz = 0          * 1e-9;
I2zx = 0          * 1e-9;
I2zy = 0          * 1e-9;
I2zz = 617772.19  * 1e-9;

%% INERCIAS DEL ESLABÓN 3
I3xx = 263136.28  * 1e-9;
I3xy = -45.60     * 1e-9;
I3xz = 84.86      * 1e-9;
I3yx = -45.60     * 1e-9;
I3yy = 175646.01  * 1e-9;
I3yz = -5573.97   * 1e-9;
I3zx = 84.86      * 1e-9;
I3zy = -5573.97   * 1e-9;
I3zz = 124274.92  * 1e-9;

%% DISTANCIAS Y LONGITUDES
% d1    = 0.061;     % [m]
% d1cm  = 0.0305;    % [m]
a2    = 0.14814;   % [m]
a2cm  = 0.07407;   % [m]
% d4    = 0.1165;    % [m]
d4cm  = 0.05825;   % [m]


for i=1:length(t)
   T1(i)=qdd(i,3).*(I3zz.*sin(q(i,2)+q(i,3))+cos(q(i,2)+q(i,3)).*(I3xz.* ...
cos(q(i,4))+(-1).*I3yz.*sin(q(i,4))))+qdd(i,2).*(sin(q(i,2)+q(i,3) ...
).*(I3zy.*cos(q(i,4))+I3zx.*sin(q(i,4)))+(1/2).*cos(q(i,2)+q(i,3)) ...
.*(I3xy+(-1).*I3yx+(I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).* ...
sin(2.*q(i,4))))+qdd(i,3).*(sin(q(i,2)+q(i,3)).*(I3zy.*cos(q(i,4)) ...
+I3zx.*sin(q(i,4)))+(1/2).*cos(q(i,2)+q(i,3)).*(I3xy+(-1).*I3yx+( ...
I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))+ ...
qdd(i,1).*(a2cm.^2.*M2.*cos(q(i,2)).^2+M3.*(a2.*cos(q(i,2))+d4cm.* ...
cos(q(i,2)+q(i,3))).^2+(1/4).*(4.*I1yy+2.*I2xx+2.*I2yy+I3xx+I3yy+ ...
2.*I3zz+2.*((-1).*I2xx+I2yy).*cos(2.*q(i,2))+(I3xx+I3yy+(-2).* ...
I3zz).*cos(2.*(q(i,2)+q(i,3)))+2.*sin(2.*(q(i,2)+q(i,3))).*((I3xz+ ...
I3zx).*cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i,4)))+2.*cos(q(i,2)+ ...
q(i,3)).^2.*((I3xx+(-1).*I3yy).*cos(2.*q(i,4))+(-1).*(I3xy+I3yx).* ...
sin(2.*q(i,4)))))+qd(i,4).*(qd(i,4).*cos(q(i,2)+q(i,3)).*((-1).* ...
I3yz.*cos(q(i,4))+(-1).*I3xz.*sin(q(i,4)))+(1/2).*qd(i,2).*(I3zz.* ...
cos(q(i,2)+q(i,3))+(-1).*sin(q(i,2)+q(i,3)).*(I3xz.*cos(q(i,4))+( ...
-1).*I3yz.*sin(q(i,4)))+sin(q(i,2)+q(i,3)).*(I3zx.*cos(q(i,4))+( ...
-1).*I3zy.*sin(q(i,4)))+(1/2).*cos(q(i,2)+q(i,3)).*(2.*(I3xx+(-1) ...
.*I3yy).*cos(2.*q(i,4))+(-2).*(I3xy+I3yx).*sin(2.*q(i,4))))+(1/2) ...
.*qd(i,3).*(I3zz.*cos(q(i,2)+q(i,3))+(-1).*sin(q(i,2)+q(i,3)).*( ...
I3xz.*cos(q(i,4))+(-1).*I3yz.*sin(q(i,4)))+sin(q(i,2)+q(i,3)).*( ...
I3zx.*cos(q(i,4))+(-1).*I3zy.*sin(q(i,4)))+(1/2).*cos(q(i,2)+q(i, ...
3)).*(2.*(I3xx+(-1).*I3yy).*cos(2.*q(i,4))+(-2).*(I3xy+I3yx).*sin( ...
2.*q(i,4))))+(1/8).*qd(i,1).*(2.*sin(2.*(q(i,2)+q(i,3))).*((-1).*( ...
I3yz+I3zy).*cos(q(i,4))+(-1).*(I3xz+I3zx).*sin(q(i,4)))+2.*cos(q( ...
i,2)+q(i,3)).^2.*((-2).*(I3xy+I3yx).*cos(2.*q(i,4))+(-2).*(I3xx+( ...
-1).*I3yy).*sin(2.*q(i,4)))))+qd(i,3).*((1/2).*qd(i,4).*(I3zz.* ...
cos(q(i,2)+q(i,3))+(-1).*sin(q(i,2)+q(i,3)).*(I3xz.*cos(q(i,4))+( ...
-1).*I3yz.*sin(q(i,4)))+sin(q(i,2)+q(i,3)).*(I3zx.*cos(q(i,4))+( ...
-1).*I3zy.*sin(q(i,4)))+(1/2).*cos(q(i,2)+q(i,3)).*(2.*(I3xx+(-1) ...
.*I3yy).*cos(2.*q(i,4))+(-2).*(I3xy+I3yx).*sin(2.*q(i,4))))+(1/2) ...
.*qd(i,2).*(2.*cos(q(i,2)+q(i,3)).*(I3zy.*cos(q(i,4))+I3zx.*sin(q( ...
i,4)))+(-1).*sin(q(i,2)+q(i,3)).*(I3xy+(-1).*I3yx+(I3xy+I3yx).* ...
cos(2.*q(i,4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))+(1/2).*qd(i,3) ...
.*(2.*cos(q(i,2)+q(i,3)).*(I3zy.*cos(q(i,4))+I3zx.*sin(q(i,4)))+( ...
-1).*sin(q(i,2)+q(i,3)).*(I3xy+(-1).*I3yx+(I3xy+I3yx).*cos(2.*q(i, ...
4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))+(1/2).*qd(i,1).*((-2).* ...
d4cm.*M3.*(a2.*cos(q(i,2))+d4cm.*cos(q(i,2)+q(i,3))).*sin(q(i,2)+ ...
q(i,3))+(1/4).*((-2).*(I3xx+I3yy+(-2).*I3zz).*sin(2.*(q(i,2)+q(i, ...
3)))+4.*cos(2.*(q(i,2)+q(i,3))).*((I3xz+I3zx).*cos(q(i,4))+(-1).*( ...
I3yz+I3zy).*sin(q(i,4)))+(-4).*cos(q(i,2)+q(i,3)).*sin(q(i,2)+q(i, ...
3)).*((I3xx+(-1).*I3yy).*cos(2.*q(i,4))+(-1).*(I3xy+I3yx).*sin(2.* ...
q(i,4))))))+qd(i,2).*((1/2).*qd(i,4).*(I3zz.*cos(q(i,2)+q(i,3))+( ...
-1).*sin(q(i,2)+q(i,3)).*(I3xz.*cos(q(i,4))+(-1).*I3yz.*sin(q(i,4) ...
))+sin(q(i,2)+q(i,3)).*(I3zx.*cos(q(i,4))+(-1).*I3zy.*sin(q(i,4))) ...
+(1/2).*cos(q(i,2)+q(i,3)).*(2.*(I3xx+(-1).*I3yy).*cos(2.*q(i,4))+ ...
(-2).*(I3xy+I3yx).*sin(2.*q(i,4))))+(1/2).*qd(i,2).*(2.*cos(q(i,2) ...
+q(i,3)).*(I3zy.*cos(q(i,4))+I3zx.*sin(q(i,4)))+(-1).*sin(q(i,2)+ ...
q(i,3)).*(I3xy+(-1).*I3yx+(I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).* ...
I3yy).*sin(2.*q(i,4))))+(1/2).*qd(i,3).*(2.*cos(q(i,2)+q(i,3)).*( ...
I3zy.*cos(q(i,4))+I3zx.*sin(q(i,4)))+(-1).*sin(q(i,2)+q(i,3)).*( ...
I3xy+(-1).*I3yx+(I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).* ...
sin(2.*q(i,4))))+(1/2).*qd(i,1).*((-2).*a2cm.^2.*M2.*cos(q(i,2)).* ...
sin(q(i,2))+2.*M3.*(a2.*cos(q(i,2))+d4cm.*cos(q(i,2)+q(i,3))).*(( ...
-1).*a2.*sin(q(i,2))+(-1).*d4cm.*sin(q(i,2)+q(i,3)))+(1/4).*((-4) ...
.*((-1).*I2xx+I2yy).*sin(2.*q(i,2))+(-2).*(I3xx+I3yy+(-2).*I3zz).* ...
sin(2.*(q(i,2)+q(i,3)))+4.*cos(2.*(q(i,2)+q(i,3))).*((I3xz+I3zx).* ...
cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i,4)))+(-4).*cos(q(i,2)+q(i, ...
3)).*sin(q(i,2)+q(i,3)).*((I3xx+(-1).*I3yy).*cos(2.*q(i,4))+(-1).* ...
(I3xy+I3yx).*sin(2.*q(i,4))))))+qd(i,1).*((1/8).*qd(i,4).*(2.*sin( ...
2.*(q(i,2)+q(i,3))).*((-1).*(I3yz+I3zy).*cos(q(i,4))+(-1).*(I3xz+ ...
I3zx).*sin(q(i,4)))+2.*cos(q(i,2)+q(i,3)).^2.*((-2).*(I3xy+I3yx).* ...
cos(2.*q(i,4))+(-2).*(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))+(1/2).* ...
qd(i,3).*((-2).*d4cm.*M3.*(a2.*cos(q(i,2))+d4cm.*cos(q(i,2)+q(i,3) ...
)).*sin(q(i,2)+q(i,3))+(1/4).*((-2).*(I3xx+I3yy+(-2).*I3zz).*sin( ...
2.*(q(i,2)+q(i,3)))+4.*cos(2.*(q(i,2)+q(i,3))).*((I3xz+I3zx).*cos( ...
q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i,4)))+(-4).*cos(q(i,2)+q(i,3)).* ...
sin(q(i,2)+q(i,3)).*((I3xx+(-1).*I3yy).*cos(2.*q(i,4))+(-1).*( ...
I3xy+I3yx).*sin(2.*q(i,4)))))+(1/2).*qd(i,2).*((-2).*a2cm.^2.*M2.* ...
cos(q(i,2)).*sin(q(i,2))+2.*M3.*(a2.*cos(q(i,2))+d4cm.*cos(q(i,2)+ ...
q(i,3))).*((-1).*a2.*sin(q(i,2))+(-1).*d4cm.*sin(q(i,2)+q(i,3)))+( ...
1/4).*((-4).*((-1).*I2xx+I2yy).*sin(2.*q(i,2))+(-2).*(I3xx+I3yy+( ...
-2).*I3zz).*sin(2.*(q(i,2)+q(i,3)))+4.*cos(2.*(q(i,2)+q(i,3))).*(( ...
I3xz+I3zx).*cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i,4)))+(-4).*cos( ...
q(i,2)+q(i,3)).*sin(q(i,2)+q(i,3)).*((I3xx+(-1).*I3yy).*cos(2.*q( ...
i,4))+(-1).*(I3xy+I3yx).*sin(2.*q(i,4))))));

T2(i)=(1/2).*(2.*qdd(i,2).*a2cm.^2.*M2+2.*a2cm.*grav.*M2.*cos(q(i,2))+ ...
2.*qdd(i,3).*d4cm.*M3.*(d4cm+a2.*cos(q(i,3)))+2.*qdd(i,2).*M3.*( ...
a2.^2+d4cm.^2+2.*a2.*d4cm.*cos(q(i,3)))+2.*grav.*M3.*(a2.*cos(q(i, ...
2))+d4cm.*cos(q(i,2)+q(i,3)))+(-4).*qd(i,2).*qd(i,3).*a2.*d4cm.* ...
M3.*sin(q(i,3))+(-2).*qd(i,3).^2.*a2.*d4cm.*M3.*sin(q(i,3))+2.* ...
qdd(i,3).*(I3yz.*cos(q(i,4))+I3xz.*sin(q(i,4)))+2.*qdd(i,1).*sin( ...
q(i,2)+q(i,3)).*(I3yz.*cos(q(i,4))+I3xz.*sin(q(i,4)))+2.*qd(i,4) ...
.^2.*(I3xz.*cos(q(i,4))+(-1).*I3yz.*sin(q(i,4)))+qd(i,1).*qd(i,2) ...
.*((I3xy+(-1).*I3yx).*sin(q(i,2)+q(i,3))+cos(q(i,2)+q(i,3)).*(( ...
I3yz+(-1).*I3zy).*cos(q(i,4))+(I3xz+(-1).*I3zx).*sin(q(i,4))))+qd( ...
i,1).*qd(i,3).*((I3xy+(-1).*I3yx).*sin(q(i,2)+q(i,3))+cos(q(i,2)+ ...
q(i,3)).*((I3yz+(-1).*I3zy).*cos(q(i,4))+(I3xz+(-1).*I3zx).*sin(q( ...
i,4))))+qdd(i,3).*(I3xx+I3yy+((-1).*I3xx+I3yy).*cos(2.*q(i,4))+( ...
I3xy+I3yx).*sin(2.*q(i,4)))+qdd(i,2).*(2.*I2zz+I3xx+I3yy+((-1).* ...
I3xx+I3yy).*cos(2.*q(i,4))+(I3xy+I3yx).*sin(2.*q(i,4)))+qdd(i,1).* ...
cos(q(i,2)+q(i,3)).*((-1).*I3xy+I3yx+(I3xy+I3yx).*cos(2.*q(i,4))+( ...
I3xx+(-1).*I3yy).*sin(2.*q(i,4)))+qd(i,2).*qd(i,4).*(2.*(I3xy+ ...
I3yx).*cos(2.*q(i,4))+2.*(I3xx+(-1).*I3yy).*sin(2.*q(i,4)))+qd(i, ...
3).*qd(i,4).*(2.*(I3xy+I3yx).*cos(2.*q(i,4))+2.*(I3xx+(-1).*I3yy) ...
.*sin(2.*q(i,4)))+qd(i,1).^2.*(((-1).*I2xx+I2yy).*sin(2.*q(i,2))+ ...
a2cm.^2.*M2.*sin(2.*q(i,2))+2.*M3.*(a2.*cos(q(i,2))+d4cm.*cos(q(i, ...
2)+q(i,3))).*(a2.*sin(q(i,2))+d4cm.*sin(q(i,2)+q(i,3)))+(1/2).*( ...
I3xx+I3yy+(-2).*I3zz).*sin(2.*(q(i,2)+q(i,3)))+(-1).*cos(2.*(q(i, ...
2)+q(i,3))).*((I3xz+I3zx).*cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i, ...
4)))+cos(q(i,2)+q(i,3)).*sin(q(i,2)+q(i,3)).*((I3xx+(-1).*I3yy).* ...
cos(2.*q(i,4))+(-1).*(I3xy+I3yx).*sin(2.*q(i,4))))+qd(i,1).*qd(i, ...
4).*(2.*sin(q(i,2)+q(i,3)).*(I3xz.*cos(q(i,4))+(-1).*I3yz.*sin(q( ...
i,4)))+(-1).*cos(q(i,2)+q(i,3)).*(I3zz+((-1).*I3xx+I3yy).*cos(2.* ...
q(i,4))+(I3xy+I3yx).*sin(2.*q(i,4))))+qd(i,1).*qd(i,4).*(sin(q(i, ...
2)+q(i,3)).*((I3xz+I3zx).*cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i, ...
4)))+(-1).*cos(q(i,2)+q(i,3)).*(I3zz+((-1).*I3xx+I3yy).*cos(2.*q( ...
i,4))+(I3xy+I3yx).*sin(2.*q(i,4)))));

T3(i)=(1/4).*(4.*d4cm.*M3.*(grav.*cos(q(i,2)+q(i,3))+a2.*(qdd(i,2).*cos( ...
q(i,3))+qd(i,2).^2.*sin(q(i,3))+qd(i,1).^2.*cos(q(i,2)).*sin(q(i, ...
2)+q(i,3))))+2.*d4cm.^2.*M3.*(2.*(qdd(i,2)+qdd(i,3))+qd(i,1).^2.* ...
sin(2.*(q(i,2)+q(i,3))))+qd(i,1).^2.*((-2).*cos(2.*(q(i,2)+q(i,3)) ...
).*((I3xz+I3zx).*cos(q(i,4))+(-1).*(I3yz+I3zy).*sin(q(i,4)))+sin( ...
2.*(q(i,2)+q(i,3))).*(I3xx+I3yy+(-2).*I3zz+(I3xx+(-1).*I3yy).*cos( ...
2.*q(i,4))+(-1).*(I3xy+I3yx).*sin(2.*q(i,4))))+2.*(qdd(i,2).*I3xx+ ...
qdd(i,3).*I3xx+qdd(i,2).*I3yy+qdd(i,3).*I3yy+(-1).*qdd(i,1).* ...
I3xy.*cos(q(i,2)+q(i,3))+qdd(i,1).*I3yx.*cos(q(i,2)+q(i,3))+2.*qd( ...
i,4).^2.*I3xz.*cos(q(i,4))+2.*qdd(i,3).*I3yz.*cos(q(i,4))+(-1).* ...
qdd(i,2).*I3xx.*cos(2.*q(i,4))+(-1).*qdd(i,3).*I3xx.*cos(2.*q(i,4) ...
)+qdd(i,2).*I3yy.*cos(2.*q(i,4))+qdd(i,3).*I3yy.*cos(2.*q(i,4))+ ...
qdd(i,1).*I3xy.*cos(q(i,2)+q(i,3)).*cos(2.*q(i,4))+qdd(i,1).* ...
I3yx.*cos(q(i,2)+q(i,3)).*cos(2.*q(i,4))+2.*qdd(i,1).*I3yz.*cos(q( ...
i,4)).*sin(q(i,2)+q(i,3))+2.*qdd(i,3).*I3xz.*sin(q(i,4))+(-2).*qd( ...
i,4).^2.*I3yz.*sin(q(i,4))+2.*qdd(i,1).*I3xz.*sin(q(i,2)+q(i,3)).* ...
sin(q(i,4))+qdd(i,2).*I3xy.*sin(2.*q(i,4))+qdd(i,3).*I3xy.*sin(2.* ...
q(i,4))+qdd(i,2).*I3yx.*sin(2.*q(i,4))+qdd(i,3).*I3yx.*sin(2.*q(i, ...
4))+qdd(i,1).*I3xx.*cos(q(i,2)+q(i,3)).*sin(2.*q(i,4))+(-1).*qdd( ...
i,1).*I3yy.*cos(q(i,2)+q(i,3)).*sin(2.*q(i,4))+2.*qd(i,2).*qd(i,4) ...
.*((I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4)))+ ...
2.*qd(i,3).*qd(i,4).*((I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).* ...
I3yy).*sin(2.*q(i,4))))+2.*qd(i,1).*(qd(i,2).*((I3xy+(-1).*I3yx).* ...
sin(q(i,2)+q(i,3))+cos(q(i,2)+q(i,3)).*((I3yz+(-1).*I3zy).*cos(q( ...
i,4))+(I3xz+(-1).*I3zx).*sin(q(i,4))))+qd(i,3).*((I3xy+(-1).*I3yx) ...
.*sin(q(i,2)+q(i,3))+cos(q(i,2)+q(i,3)).*((I3yz+(-1).*I3zy).*cos( ...
q(i,4))+(I3xz+(-1).*I3zx).*sin(q(i,4))))+(-1).*qd(i,4).*(sin(q(i, ...
2)+q(i,3)).*((-1).*(3.*I3xz+I3zx).*cos(q(i,4))+(3.*I3yz+I3zy).* ...
sin(q(i,4)))+2.*cos(q(i,2)+q(i,3)).*(I3zz+((-1).*I3xx+I3yy).*cos( ...
2.*q(i,4))+(I3xy+I3yx).*sin(2.*q(i,4))))));

T4(i)=(1/4).*(qd(i,1).^2.*(sin(2.*(q(i,2)+q(i,3))).*((I3yz+I3zy).*cos(q( ...
i,4))+(I3xz+I3zx).*sin(q(i,4)))+2.*cos(q(i,2)+q(i,3)).^2.*((I3xy+ ...
I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))+2.*qd(i, ...
1).*(qd(i,4).*cos(q(i,2)+q(i,3)).*((I3yz+(-1).*I3zy).*cos(q(i,4))+ ...
(I3xz+(-1).*I3zx).*sin(q(i,4)))+qd(i,2).*(sin(q(i,2)+q(i,3)).*(( ...
-1).*(I3xz+3.*I3zx).*cos(q(i,4))+(I3yz+3.*I3zy).*sin(q(i,4)))+2.* ...
cos(q(i,2)+q(i,3)).*(I3zz+((-1).*I3xx+I3yy).*cos(2.*q(i,4))+(I3xy+ ...
I3yx).*sin(2.*q(i,4))))+qd(i,3).*(sin(q(i,2)+q(i,3)).*((-1).*( ...
I3xz+3.*I3zx).*cos(q(i,4))+(I3yz+3.*I3zy).*sin(q(i,4)))+2.*cos(q( ...
i,2)+q(i,3)).*(I3zz+((-1).*I3xx+I3yy).*cos(2.*q(i,4))+(I3xy+I3yx) ...
.*sin(2.*q(i,4)))))+(-2).*(qd(i,3).*qd(i,4).*((I3xz+(-1).*I3zx).* ...
cos(q(i,4))+((-1).*I3yz+I3zy).*sin(q(i,4)))+(-2).*(qdd(i,3).*I3zz+ ...
qdd(i,3).*I3zy.*cos(q(i,4))+qdd(i,3).*I3zx.*sin(q(i,4))+qdd(i,2).* ...
(I3zy.*cos(q(i,4))+I3zx.*sin(q(i,4)))+qdd(i,1).*(I3zz.*sin(q(i,2)+ ...
q(i,3))+cos(q(i,2)+q(i,3)).*(I3zx.*cos(q(i,4))+(-1).*I3zy.*sin(q( ...
i,4)))))+qd(i,2).^2.*((I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).* ...
I3yy).*sin(2.*q(i,4)))+qd(i,3).^2.*((I3xy+I3yx).*cos(2.*q(i,4))+( ...
I3xx+(-1).*I3yy).*sin(2.*q(i,4)))+qd(i,2).*(qd(i,4).*((I3xz+(-1).* ...
I3zx).*cos(q(i,4))+((-1).*I3yz+I3zy).*sin(q(i,4)))+2.*qd(i,3).*(( ...
I3xy+I3yx).*cos(2.*q(i,4))+(I3xx+(-1).*I3yy).*sin(2.*q(i,4))))));
   
end

figure
subplot(2,2,1)
plot(t, T1)
title('Torque 1')

subplot(2,2,2)
plot(t, T2)
title('Torque 2')

subplot(2,2,3)
plot(t, T3)
title('Torque 3')

subplot(2,2,4)
plot(t, T4)
title('Torque 4')
